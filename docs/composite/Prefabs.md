# Префабы

Здесь описаны все префабы библиотеки.

В процессе работы все префабы берут данные из одного хранилища с настройками
(configStore), поэтому параметры для них нужно помещать в это хранилище.

Хранилище получает данные из php кода (см. документацию по iew helper'ам)
или из js конфига. Он представляет собой dojo модуль, который возвращает массив
из обьектов с настройками, которые потом будут доступны через configStore.

Если в  js код нужно передать функцию, то нужно передать её имя в следующем виде:
`func{<имя функции>}`. Функция <имя функции> должна хранится в js конфиге.
Запись выглядит следующим образом:
```
{
    ‘id’: ‘<имя функции>’,
    'func': ‘<тело функции>’,
}
```
Встретив запись `func{<имя функции>}`, js фабрики будут пытаться достать свойство
`<имя функции>` из configStore.
Если в  js код нужно передать `rollun-rql` query обьект, то сделать это можно,
передав его rql в следующем виде : `rql{<rql строка>}`. Фабрика превратит такую
запись в rollun-rql query обьект и передаст его модулю.

Все префабы содержат _PrefabBase миксин, который и представляет описанные выше
возможности. Подробнее об этом написанно в доке по миксинам.

## ConditionPanel Prefab
Создаёт ConditionControlPanel.
* Если передать адрес хранилища, то оно
* Конфиг:
```
{
 	'id': 'conditionsStoreUrl',
 	'url': 'my/store/with/conditions' // URL REST хранилища с фильтрами. Если этого параметра не будет, то фильтры
                                      // будут храниться в памяти.
}
```

## ConditionsInMenu Prefab
Создает группу кнопок, каждая из которых открывает выезжающеее окно. В группе
всегда присутствует как минимум одна кнопка (панель условий). Дополнительные
кнопки добавляются в меню, если есть соответсующие настройки в configStore.
Доступные разделы меню:
* Меню условий: см. `ConditionPanel Prefab`
* Меню задач:
    * Пердставляет из себя группу кнопок, каждая из которых выполняет
    какое-то дйствие используя данные из выбранной в таблице строки
    * В функцию-обработчик первым параметром будет переданна строка из таблицы,
    а после - параметры из конфига.
* Меню работы с файлами:
    * Представляет из себя группу кнопок, которые активируют модули для
    работы с файлами. На даный момент доступен только загрузчик из .csv

* Пример конфига:
```
{
			"id": "conditionsInMenu",
			"actionMenuConfig": [
				{
					"label": "Do Something", // Надпись на кнопке
					"action": {
						"action": "func{myActionFunction}", //Имя функции-обработчика
						"params": ["/webhook/doSomethingAction"] //Массив параметров, которые будут переданы в обработчик
	                                                             //после строки из таблицы
					}
				},
				{
					"label": "Do Something Else",
					"action": {
						"action": "func{myActionFunction}",
						"params": ["/webhook/doSomethingAction"]
					}
				},
			],
			'fileActions': {
				'fileToDatastore': {
					'storeUrl': 'my/store', //адрес хранилища, в которое будут загружены данные
					'removeNumberOfRows': 5, //Кол-во строк от начала файла, которые будут пропущены
				}
			}
		},
```

## Pagination Prefab
Создаёт пагинатор. Не использует параметров из configStore, но принимает
номер стартовой страницы в конструкторе. Последняя страница
задаётся строкой `'last'`.
```
//...
const pagination = (new PaginationPrefab({startingPage: 33})).deploy(configStore)
//...
```
## PasteInputUploader Prefab
Создаёт PasteInputUploader. Параметры:
* `storeUrl` - адрес хранилища, в которое будет осуществялся запись.
* `validator` - валидатор ввода. Должен выбрасывать исклюение при невалидном вводе.
* `noId` - переключает режим noId. Загрузчик будет отбрасывать
    первый столбец таблицы, который по идее содержит id.
* `fieldsToUpload` - массив имён полей, в которые буду добавлены значения.
* `hasHeaderLine` - переключает режим noHeaderLine. В этом реижме загрузчик
    игнорирует первую строку ввода, которая по идее сдержит шапку таблицы.
Пример конфига:
```
{
	 'id' : 'pasteInputUploader',
	 'storeUrl': 'api/datastore/test1_csv',
	 'validator': `func{myValidator}`,
	 'noId': true,
	 'fieldsToUpload': null,
	 'hasHeaderLine': false,
}
```
## Rgrid Prefab
Создаёт Rgrid.
* Передаёт в него адрес таблицы, стартовый rql фильтр и настройки столбцов.
* Поддерживаются следующие настройки столбцов:
    * геттер
    * форматтер
    * рендерер клеток таблицы
    * ширина
    * изначальная видимость
Конфиг:
```
		{
			'id': 'rgrid',
			'gridTarget': 'api/datastore/test1_csv', // url ранилища данных, которое отобразит таблица
			'initialQuery': 'rql{contains(id,1)}', // стартовый rql фильтр
			'columnParams': { // настройки отображения столбцов таблицы
				'products': { // имя столбца
					'get': 'func{prettyStringify}', // обработчик, который преобразовывает данные перед рендерингом
					'formatter': 'func{prettyJsonFormatter}', // обработчик, возвращающий html, кторый будет отрисован в клетке таблицы
					'renderCell': 'func{contentInTitlePane}', // обработчик, возвращающий ноду, которая будеь помещена вместо клетки в таблице
					'width': 700 // желаемая минимальная ширина столбца в пикселях
				},
				'datetime': { // имя другого столбца
					'formatter': 'func{datetimeConverter}',
					'hidden' : true // этот столбец изначально скрыт
				}
			}
		},
```
## Search Prefab
Создаёт поисковую строку. Не использует параметров из configStore