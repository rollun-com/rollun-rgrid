# Компоненты для работы с RQL
Rgrid использует библиотеку [rollun-rql](https://github.com/rollun-com/rollun-rql)
для представления RQL запросов в виде обьектов - Query, или нод. Эта библиотека предоставляет базовый
функционал для создания Query и парсинга их в строку и обратно. А для слияния Query используется
RqlBuilder.
## RqlBuilder
Класс, дающий возможность сложные запросы из нескольких RQL нод, а также
кеширование и строительство ноды из кеша. Создаётся он через `new`, его
конструктор не принимает параметров:
```
require(['rgrid/RqlBuilder'], (RqlBuilder) => {
const rqlBuilder = new RqlBuilder()
});
```
### Методы для работы с Query
* `setQuery(query: rollun-rql/Query)` - заменяет внутренний query *копией*
переданного;
* `getQuery():rollun-rql/Query` - возвращает *копию* внутреннего Query;
* `appendQuery(query: rollun-rql/Query)` -  создаёт Query из внутреннего и
переданного Query
    * Если передана Query с именем `'select'`, `'sort'` или `'limit'`, то соответствующая
    нода в старом запросе будет заменена. Если соответствующей ноды в текущем
    Query нет, то новая нода будет добавлена по 'and'.
    * Если передана агрегатная нода, то все её дети будут добавлены в текущий
    Query.
    * Если передана другая нода, то она будет обьеденина по 'and' с текущей нодой.
### Методы для работы с кешем нод
RqlBuilder предоставляет возможность добавлять ноды в кеш, удалять их из него,
а также строить Query из нод в кеше. Эта возможность очень полезна, когда Вы
хотите динамически добавлять и удалять ноды в Query, а потом перейти в состояние,
которое было до добавления.

* `addToCache(id, node)` - добавляет ноду в кеш;
    * Если в кеше уже есть нода с таким id, то она будет перезаписана;
    * RqlBuilder резервирует некоторые id нод для специального использования.
    Об этом написано ниже.
* `removeFromCache(id)` - удаляет из кеша ноду с переданнным id;
* `setQueryFromCache()` - заменяет внутренний Query новым, построенным из кеша

RqlBuilder резервирует следующие id нод:
* `'default'` - Нода, которая будет основой для последующих восстановлений из
 кеша. Все остальные ноды будут добавлены в неё по правилам метода `appendQuery`.
 По умолчанию это пустая нода `'and'`.